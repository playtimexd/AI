<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Gameworks: Creation Galaxy</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        html { font-size: 18px; }
        body { margin: 0; overflow-x: hidden; background-color: #020617; font-family: 'Inter', sans-serif; }
        .clip-path-polygon {
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #334155; }
        
        @keyframes beam-flow {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 100%; }
        }
        .energy-beam {
            background: linear-gradient(to bottom, transparent, rgba(34, 211, 238, 0.5) 50%, transparent);
            background-size: 100% 200%;
            animation: beam-flow 2s linear infinite;
        }
    </style>

    <!-- 3. Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0",
        "three": "https://esm.sh/three@0.160.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';
        import * as THREE from 'three';
        import { 
            Brain, Layers, Gamepad2, Users, Activity, Code, Box, Music, Video, 
            Search, Globe, BarChart, Database, Zap, ChevronRight, ArrowRight, 
            Menu, X, Mail, Linkedin, Twitter, Cpu, FlaskConical, FileText, 
            Wrench, MessageSquare, Tag, Star, Lock, Unlock, Play, ChevronLeft,
            Shield, Sword, Scroll, Map, TestTube, Microscope, Terminal, Calendar,
            Server, Orbit, Rocket, Satellite, Timer, TrendingUp, CheckCircle2,
            Target
        } from 'lucide-react';

        /* --- DATA --- */
        const PHASES_CONFIG = [
            { id: "preprod", name: "Pre-production", desc: "The Brain: Ideation & Raw Concepts", color: 0xd946ef, type: "brain", x: -90 }, 
            { id: "production", name: "Production", desc: "The Construct: Rough but Forming", color: 0xf97316, type: "construct", x: -45 },
            { id: "qa", name: "QA & Polish", desc: "The Sphere: Polished Perfection", color: 0x10b981, type: "perfect", x: 0 },
            { id: "liveops", name: "LiveOps", desc: "The Nexus: Data Stream & Updates", color: 0x8b5cf6, type: "nexus", x: 45 },
            { id: "future", name: "Future Tech", desc: "The Ascendant: Enhanced & Winged", color: 0x06b6d4, type: "winged", x: 90 }
        ];

        const DOMAINS_DATA = {
            "design": { title: "Game Design / Narrative", icon: <Gamepad2 />, phase_modules: [{ id: "design_concept", phase: "preprod", name: "AI Design Brainstorming" }, { id: "design_level", phase: "preprod", name: "Level Blockout Gen" }, { id: "design_narrative", phase: "preprod", name: "AI Narrative Branching" }], headerDesc: "AI as the designer's 'Second Brain'.", tools: ["Claude 3.5", "Ludo.ai"], flow: ["Goals", "Combo Exploration", "Blockout", "Narrative", "Analysis"], comparison: [{ dimension: "Brainstorming", trad: "Limited", ai: "Massive", score: 92 }], value: [{ label: "Efficiency", val: "50%", desc: "Faster iteration" }], roles: { ai: "Divergent", human: "Core Experience" } },
            "art": { title: "Art AI Production", icon: <Box />, phase_modules: [{ id: "art_concept", phase: "preprod", name: "AI Concept Art" }, { id: "art_production", phase: "production", name: "Asset Batch Gen" }, { id: "art_texture", phase: "production", name: "AI Texturing" }], headerDesc: "Accelerating style exploration.", tools: ["Stable Diffusion", "Midjourney"], flow: ["Brief", "Moodboard", "Concept", "Multi-view", "3D", "QA"], comparison: [{ dimension: "Exploration", trad: "Slow", ai: "Rapid", score: 90 }], value: [{ label: "Time", val: "-70%", desc: "Lock direction" }], roles: { ai: "Drafting", human: "Direction" } },
            "audio": { title: "Audio AI Pipeline", icon: <Music />, phase_modules: [{ id: "audio_temp", phase: "preprod", name: "Temp Audio / TTS" }, { id: "audio_prod", phase: "production", name: "AI BGM & SFX" }], headerDesc: "Accelerating auditory creation.", tools: ["Suno AI", "ElevenLabs"], flow: ["Direction", "Placeholder", "BGM", "SFX", "VO"], comparison: [{ dimension: "Placeholders", trad: "Manual", ai: "Instant", score: 95 }], value: [{ label: "Immersion", val: "Instant", desc: "Prototype phase" }], roles: { ai: "Placeholders", human: "Emotion" } },
            "3d_asset": { title: "3D Asset AI", icon: <Box />, phase_modules: [{id:"3d_proto", phase:"preprod", name:"Prototype 3D"}, {id:"3d_prod", phase:"production", name:"High-Res 3D Gen"}], headerDesc: "Streamlining 3D production.", tools: ["Meshy", "CSM"], flow: ["Asset Req", "Draft Gen", "Retopo", "UV", "Material"], comparison: [{dimension:"Drafting", trad:"Manual", ai:"Auto", score:85}], value: [{label:"Speed", val:"5x", desc:"Faster base mesh"}], roles: {ai:"Drafting", human:"Polish"} },
            "pv": { title: "PV / Trailer", icon: <Video />, phase_modules: [{id:"pv_draft", phase:"preprod", name:"PV Draft / Storyboard"}, {id:"pv_final", phase:"production", name:"Final Trailer Gen"}], headerDesc: "Speed up video workflow.", tools: ["Runway", "Pika"], flow: ["Script", "Storyboard", "Gen Video", "Edit"], comparison: [{dimension:"Storyboard", trad:"Draw", ai:"Gen", score:90}], value: [{label:"Cost", val:"Low", desc:"Cheap iteration"}], roles: {ai:"Storyboard", human:"Editing"} },
            "animation": { title: "Animation AI", icon: <Activity />, phase_modules: [{id:"anim_prod", phase:"production", name:"AI Animation Cleanup"}, {id:"anim_retarget", phase:"production", name:"Auto Retargeting"}], headerDesc: "Automating animation cleanup.", tools: ["Cascadeur"], flow: ["Mocap", "Cleanup", "Retarget"], comparison: [{dimension:"Cleanup", trad:"Manual", ai:"Auto", score:88}], value: [{label:"Efficiency", val:"High", desc:"Reduce manual keyframing"}], roles: {ai:"", human:""} },
            "qa": { title: "AI QA", icon: <Search />, phase_modules: [{id:"qa_bot", phase:"qa", name:"Automated Regression Bots"}], headerDesc: "Intelligent verification bots.", tools: ["Appium"], flow: ["Script", "Run Bot", "Report"], comparison: [{dimension:"Regression", trad:"Manual", ai:"Auto", score:95}], value: [{label:"Coverage", val:"100%", desc:"24/7 Testing"}], roles: {ai:"", human:""} },
            "localization": { title: "Localization", icon: <Globe />, phase_modules: [{id:"loc_ai", phase:"qa", name:"AI Contextual Trans"}], headerDesc: "Efficient multi-lang workflow.", tools: ["DeepL"], flow: ["Extract", "Translate", "Review"], comparison: [{dimension:"Speed", trad:"Slow", ai:"Fast", score:92}], value: [{label:"Speed", val:"10x", desc:"Instant draft"}], roles: {ai:"", human:""} },
            "tools": { title: "Engine Tools", icon: <Code />, phase_modules: [{id:"tools_gen", phase:"qa", name:"Copilot for Devs"}], headerDesc: "Supercharging engineering.", tools: ["Copilot"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "liveops": { title: "LiveOps AI", icon: <Zap />, phase_modules: [{id:"live_plan", phase:"liveops", name:"AI Event Planning"}], headerDesc: "Data-driven operations.", tools: ["Python"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "monetization": { title: "Monetization", icon: <BarChart />, phase_modules: [{id:"money_model", phase:"liveops", name:"Player LTV Modeling"}], headerDesc: "Data-driven economy.", tools: ["TensorFlow"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "npc": { title: "Smart NPC", icon: <Users />, phase_modules: [{id:"npc_brain", phase:"future", name:"Generative NPC Brain"}], headerDesc: "Next-gen intelligent NPCs.", tools: ["Inworld"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "proc_gen": { title: "Procedural Gen", icon: <Layers />, phase_modules: [{id:"pcg_world", phase:"future", name:"Infinite World Gen"}], headerDesc: "Generating playable worlds.", tools: ["PCG"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "research": { title: "AI Research", icon: <Brain />, phase_modules: [{id:"rnd_poc", phase:"future", name:"Tech Radar & PoC"}], headerDesc: "Tech assessment loop.", tools: ["ArXiv"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
        };

        const LAB_EXPERIMENTS = [ { id: 1, title: "Style Consistency", code: "PRJ-A", status: "COMPLETED", statusColor: "text-green-400 border-green-500", problem: "Style drift in SD models.", method: "LoRA + ControlNet.", conclusion: "Locks 80% features.", impact: "Iteration +40%." }, { id: 2, title: "NPC Behavior Tree", code: "PRJ-B", status: "BETA", statusColor: "text-yellow-400 border-yellow-500", problem: "Complex BT authoring.", method: "LLM to JSON.", conclusion: "90% accuracy simple logic.", impact: "Minutes prototyping." }, { id: 3, title: "Auto Regression", code: "PRJ-C", status: "ALPHA", statusColor: "text-red-400 border-red-500", problem: "Manual smoke tests.", method: "CV Agent.", conclusion: "95% UI coverage.", impact: "Freed 2 QA." } ];
        const ARTICLES_LIST = [ { id: 1, title: "AI Workflow Shift", date: "2023-10-15", category: "OPINION", summary: "Artists becoming curators.", tags: ["Art"] }, { id: 2, title: "Data-Driven Design", date: "2023-11-02", category: "TECH", summary: "RL Agents for balance.", tags: ["Design"] }, { id: 3, title: "Prompt Engineering", date: "2023-12-10", category: "ENGINEERING", summary: "Productionizing LLMs.", tags: ["DevOps"] } ];

        const getModulesByPhase = (phaseId) => {
            const modules = [];
            Object.entries(DOMAINS_DATA).forEach(([domainKey, data]) => {
                data.phase_modules.forEach(mod => {
                    if (mod.phase === phaseId) {
                        modules.push({ ...mod, domainKey, icon: data.icon, domainTitle: data.title });
                    }
                });
            });
            return modules;
        };

        /* --- THREE.JS GALAXY COMPONENT --- */
        const GalaxyScene = ({ currentPhaseIdx, onSelectModule, onChangePhase, hoverPhaseIdx, onHoverModule, onHoverPhase }) => {
            const containerRef = useRef(null);
            const requestRef = useRef();
            const planetGroupRef = useRef(null);
            const satellitesRef = useRef([]);
            const mouseRef = useRef({ x: 0, y: 0 });
            const raycasterRef = useRef(new THREE.Raycaster());
            const cameraRef = useRef(null);
            
            // Use refs for callbacks to avoid useEffect dependency cycles and flashes
            const callbacksRef = useRef({ onSelectModule, onChangePhase, onHoverModule, onHoverPhase });
            const stateRef = useRef({ currentPhaseIdx, hoverPhaseIdx, lastHoveredModuleId: null });

            // Update refs when props change
            useEffect(() => {
                stateRef.current.currentPhaseIdx = currentPhaseIdx;
                stateRef.current.hoverPhaseIdx = hoverPhaseIdx;
                callbacksRef.current = { onSelectModule, onChangePhase, onHoverModule, onHoverPhase };
            }, [currentPhaseIdx, hoverPhaseIdx, onSelectModule, onChangePhase, onHoverModule, onHoverPhase]);

            // Rebuild Satellites helper
            const rebuildSatellites = (scene, phaseId, color) => {
                // Remove old satellites from scene tracking array (and scene if needed, though we might group them)
                satellitesRef.current.forEach(sat => {
                    if (sat.userData.orbitRing) scene.remove(sat.userData.orbitRing);
                    scene.remove(sat);
                    // Dispose geometry/material
                    sat.geometry.dispose();
                    sat.material.dispose();
                });
                satellitesRef.current = [];

                const modules = getModulesByPhase(phaseId);
                modules.forEach((mod, i) => {
                    const angle = (i / modules.length) * Math.PI * 2;
                    const radius = 26; 
                    const x = Math.cos(angle) * radius;
                    const z = Math.sin(angle) * radius;

                    let geo;
                    if (mod.domainKey === 'art' || mod.domainKey === '3d_asset') geo = new THREE.IcosahedronGeometry(1.5, 0); 
                    else if (mod.domainKey === 'design' || mod.domainKey === 'proc_gen') geo = new THREE.BoxGeometry(2.2, 2.2, 2.2);
                    else if (mod.domainKey === 'audio') geo = new THREE.TorusGeometry(1.2, 0.4, 8, 16);
                    else if (mod.domainKey === 'animation' || mod.domainKey === 'npc') geo = new THREE.OctahedronGeometry(1.5, 0); 
                    else if (mod.domainKey === 'qa' || mod.domainKey === 'tools' || mod.domainKey === 'localization') geo = new THREE.BoxGeometry(1.8, 1.8, 1.8); 
                    else if (mod.domainKey === 'monetization' || mod.domainKey === 'liveops') geo = new THREE.ConeGeometry(1.2, 2.5, 4);
                    else geo = new THREE.SphereGeometry(1.2, 16, 16);
                    
                    const isWireframe = (mod.domainKey === 'qa' || mod.domainKey === 'tools');
                    const mat = new THREE.MeshStandardMaterial({ 
                        color: 0xffffff, 
                        emissive: color, 
                        emissiveIntensity: 0.5, 
                        flatShading: true, 
                        roughness: 0.3, 
                        metalness: 0.8,
                        wireframe: isWireframe
                    });
                    const satMesh = new THREE.Mesh(geo, mat);
                    satMesh.position.set(x, 0, z);
                    satMesh.userData = { id: mod.id, angle: angle, radius: radius, speed: 0.0005, name: mod.name, domainTitle: mod.domainTitle };
                    
                    const orbitGeo = new THREE.RingGeometry(radius - 0.1, radius + 0.1, 128);
                    const orbitMat = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.05 });
                    const orbitRing = new THREE.Mesh(orbitGeo, orbitMat);
                    orbitRing.rotation.x = Math.PI / 2;
                    scene.add(orbitRing);
                    
                    satMesh.userData.orbitRing = orbitRing; // Link for cleanup

                    scene.add(satMesh);
                    satellitesRef.current.push(satMesh);
                });
            };

            useEffect(() => {
                if (!containerRef.current) return;

                const width = containerRef.current.clientWidth;
                const height = containerRef.current.clientHeight;
                const scene = new THREE.Scene();
                
                const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
                camera.position.set(0, 15, 85); 
                camera.lookAt(0, 0, 0);
                cameraRef.current = camera;

                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(width, height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                containerRef.current.appendChild(renderer.domElement);

                const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
                scene.add(ambientLight);
                const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
                dirLight.position.set(30, 30, 40);
                scene.add(dirLight);
                const pointLight = new THREE.PointLight(PHASES_CONFIG[0].color, 1.5, 100);
                pointLight.position.set(0, 0, 15);
                scene.add(pointLight);
                
                const allPlanetsGroup = new THREE.Group();
                scene.add(allPlanetsGroup);
                planetGroupRef.current = allPlanetsGroup;

                // Create Planets
                PHASES_CONFIG.forEach((cfg, idx) => {
                    const pGroup = new THREE.Group();
                    pGroup.position.set(cfg.x, 0, 0);
                    pGroup.userData = { id: idx, name: cfg.name };

                    let mesh;
                    if (cfg.type === 'brain') {
                        mesh = new THREE.Mesh(new THREE.TorusKnotGeometry(3.5, 1.2, 100, 16, 3, 4), new THREE.MeshStandardMaterial({ color: cfg.color, roughness: 0.5, metalness: 0.1, emissive: 0x550055, emissiveIntensity: 0.2 }));
                        pGroup.add(mesh);
                    } else if (cfg.type === 'construct') {
                        mesh = new THREE.Mesh(new THREE.IcosahedronGeometry(4.5, 0), new THREE.MeshStandardMaterial({ color: cfg.color, flatShading: true, roughness: 0.8, metalness: 0.3 }));
                        const cage = new THREE.Mesh(new THREE.IcosahedronGeometry(5.5, 1), new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true, transparent: true, opacity: 0.2 }));
                        cage.userData = { rotateSpeed: -0.002 };
                        pGroup.add(mesh); pGroup.add(cage);
                    } else if (cfg.type === 'perfect') {
                        mesh = new THREE.Mesh(new THREE.SphereGeometry(4.8, 64, 64), new THREE.MeshPhysicalMaterial({ color: cfg.color, roughness: 0.1, metalness: 0.2, clearcoat: 1.0, clearcoatRoughness: 0.1 }));
                        const shield = new THREE.Mesh(new THREE.SphereGeometry(6.2, 32, 32), new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.15, side: THREE.DoubleSide }));
                        pGroup.add(mesh); pGroup.add(shield);
                    } else if (cfg.type === 'nexus') {
                         mesh = new THREE.Mesh(new THREE.TorusKnotGeometry(3.8, 1.2, 100, 16), new THREE.MeshNormalMaterial({ flatShading: false }));
                         const ring1 = new THREE.Mesh(new THREE.TorusGeometry(7.5, 0.1, 16, 100), new THREE.MeshBasicMaterial({ color: cfg.color }));
                         ring1.rotation.x = Math.PI/2.5;
                         pGroup.add(mesh); pGroup.add(ring1);
                    } else if (cfg.type === 'winged') {
                        const core = new THREE.Mesh(new THREE.OctahedronGeometry(4.0, 0), new THREE.MeshStandardMaterial({ color: 0x000000, emissive: cfg.color, emissiveIntensity: 0.8, wireframe: true }));
                        const wingGeo = new THREE.BoxGeometry(1, 14, 3);
                        const wingMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2, metalness: 0.9 });
                        const wingL = new THREE.Mesh(wingGeo, wingMat); wingL.position.set(-7, 0, 0); wingL.rotation.z = 0.2;
                        const wingR = new THREE.Mesh(wingGeo, wingMat); wingR.position.set(7, 0, 0); wingR.rotation.z = -0.2;
                        const rotator = new THREE.Group();
                        rotator.add(core); rotator.add(wingL); rotator.add(wingR);
                        rotator.userData = { rotateSpeed: 0.01 }; 
                        pGroup.add(rotator);
                    }
                    allPlanetsGroup.add(pGroup);
                });

                // Initial Satellites
                rebuildSatellites(scene, PHASES_CONFIG[0].id, PHASES_CONFIG[0].color);

                const raycaster = new THREE.Raycaster();
                
                const onMouseMove = (e) => {
                    const rect = containerRef.current.getBoundingClientRect();
                    mouseRef.current.x = ((e.clientX - rect.left) / width) * 2 - 1;
                    mouseRef.current.y = -((e.clientY - rect.top) / height) * 2 + 1;
                };

                const onClick = () => {
                    raycaster.setFromCamera(mouseRef.current, camera);
                    const satIntersects = raycaster.intersectObjects(satellitesRef.current);
                    if (satIntersects.length > 0) {
                        callbacksRef.current.onSelectModule(satIntersects[0].object.userData.id);
                        return;
                    }
                    const planetIntersects = raycaster.intersectObjects(allPlanetsGroup.children, true);
                    if (planetIntersects.length > 0) {
                        let target = planetIntersects[0].object;
                        while(target.parent !== allPlanetsGroup) { target = target.parent; }
                        callbacksRef.current.onChangePhase(target.userData.id); 
                    }
                };

                containerRef.current.addEventListener('mousemove', onMouseMove);
                containerRef.current.addEventListener('click', onClick);

                let lastRenderedPhaseIdx = 0;

                const animate = () => {
                    requestRef.current = requestAnimationFrame(animate);
                    const time = Date.now() * 0.001;
                    const { currentPhaseIdx, hoverPhaseIdx } = stateRef.current;

                    if (lastRenderedPhaseIdx !== currentPhaseIdx) {
                        lastRenderedPhaseIdx = currentPhaseIdx;
                        const p = PHASES_CONFIG[currentPhaseIdx];
                        rebuildSatellites(scene, p.id, p.color);
                        pointLight.color.setHex(p.color);
                    }

                    if (planetGroupRef.current) {
                        const activePlanetX = PHASES_CONFIG[currentPhaseIdx].x;
                        const targetGroupX = -activePlanetX;
                        planetGroupRef.current.position.x += (targetGroupX - planetGroupRef.current.position.x) * 0.08;

                        raycaster.setFromCamera(mouseRef.current, camera);
                        const planetIntersects = raycaster.intersectObjects(allPlanetsGroup.children, true);
                        
                        let hoveredPlanetId = -1;
                        if (planetIntersects.length > 0) {
                             let target = planetIntersects[0].object;
                             while(target.parent !== allPlanetsGroup) target = target.parent;
                             hoveredPlanetId = target.userData.id;
                             document.body.style.cursor = 'pointer';
                             // Pass callback safely
                             if (callbacksRef.current.onHoverPhase && hoveredPlanetId !== currentPhaseIdx) {
                                 callbacksRef.current.onHoverPhase(hoveredPlanetId);
                             }
                        } else {
                            const satIntersects = raycaster.intersectObjects(satellitesRef.current);
                            document.body.style.cursor = satIntersects.length > 0 ? 'pointer' : 'default';
                        }

                        planetGroupRef.current.children.forEach((pGroup, i) => {
                            pGroup.rotation.y += 0.002;
                            pGroup.children.forEach(child => {
                                if (child.userData.rotateSpeed) {
                                    child.rotation.y += child.userData.rotateSpeed;
                                    child.rotation.x += child.userData.rotateSpeed * 0.5;
                                }
                            });
                            if (pGroup.userData.pulse) {
                                const scale = 1 + Math.sin(time * 3) * 0.1;
                                if (pGroup.children[1]) pGroup.children[1].scale.set(scale, scale, scale);
                            }

                            let targetScale = i === currentPhaseIdx ? 1.0 : 0.8;
                            let targetOpacity = i === currentPhaseIdx ? 1.0 : 0.3; 
                            
                            if (hoveredPlanetId !== -1) {
                                if (i === hoveredPlanetId) { targetScale = 1.3; targetOpacity = 1.0; pGroup.rotation.y += 0.02; } 
                                else { targetScale = 0.6; targetOpacity = 0.1; }
                            } else if (hoverPhaseIdx !== null) {
                                if (i === hoverPhaseIdx) { targetScale = 1.3; targetOpacity = 1.0; } 
                                else { targetScale = 0.6; targetOpacity = 0.1; }
                            }

                            pGroup.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                            
                            pGroup.traverse(child => {
                                if (child.isMesh && child.material) {
                                    if (child.material.emissive) {
                                        child.material.emissiveIntensity = THREE.MathUtils.lerp(child.material.emissiveIntensity, targetOpacity * 0.8, 0.1);
                                    }
                                }
                            });
                        });
                    }

                    satellitesRef.current.forEach((sat) => {
                        sat.userData.angle += sat.userData.speed;
                        sat.position.x = Math.cos(sat.userData.angle) * sat.userData.radius;
                        sat.position.z = Math.sin(sat.userData.angle) * sat.userData.radius;
                        sat.rotation.x += 0.002; 
                        sat.rotation.y += 0.002; 
                        
                        const satIntersects = raycaster.intersectObject(sat);
                        if (satIntersects.length > 0) {
                             sat.scale.lerp(new THREE.Vector3(1.5, 1.5, 1.5), 0.2);
                             sat.material.emissiveIntensity = 2.0;
                             if (stateRef.current.lastHoveredModuleId !== sat.userData.id) {
                                 stateRef.current.lastHoveredModuleId = sat.userData.id;
                                 if (callbacksRef.current.onHoverModule) callbacksRef.current.onHoverModule(sat.userData);
                             }
                        } else {
                             sat.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                             sat.material.emissiveIntensity = 0.5;
                        }
                    });

                    if (raycaster.intersectObjects(satellitesRef.current).length === 0 && stateRef.current.lastHoveredModuleId !== null) {
                        stateRef.current.lastHoveredModuleId = null;
                        if (callbacksRef.current.onHoverModule) callbacksRef.current.onHoverModule(null);
                    }

                    const mX = (mouseRef.current.x / window.innerWidth - 0.5) * 2;
                    const mY = (mouseRef.current.y / window.innerHeight - 0.5) * 2;
                    camera.position.x += (mX * 5 - camera.position.x) * 0.05;
                    camera.position.y += ((-mY * 5 + 15) - camera.position.y) * 0.05;
                    camera.lookAt(0, 0, 0);

                    renderer.render(scene, camera);
                };
                animate();

                return () => {
                    if (containerRef.current) {
                        containerRef.current.removeEventListener('mousemove', onMouseMove);
                        containerRef.current.removeEventListener('click', onClick);
                        containerRef.current.removeChild(renderer.domElement);
                    }
                    cancelAnimationFrame(requestRef.current);
                };
            }, []); 

            return <div ref={containerRef} className="w-full h-[70vh] relative z-10" />; 
        };

        /* --- BACKGROUND PARTICLES --- */
        const createSoftTexture = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.4, 'rgba(255, 255, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = gradient; ctx.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        };

        const ThreeBackground = ({ mode }) => {
            const containerRef = useRef(null);
            const mouseRef = useRef({ x: 10000, y: 10000 }); 
            const targetColorRef = useRef(new THREE.Color(0x67e8f9));

            useEffect(() => {
                let hex = 0x67e8f9;
                switch(mode) {
                    case 'art': hex = 0xf472b6; break;
                    case 'animation': hex = 0xfacc15; break;
                    case 'qa': hex = 0x4ade80; break;
                    case 'design': hex = 0xc084fc; break;
                    case 'audio': hex = 0x3b82f6; break;
                }
                targetColorRef.current.setHex(hex);
            }, [mode]);

            useEffect(() => {
                if (!containerRef.current) return;
                const width = window.innerWidth;
                const height = window.innerHeight;
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x020617, 0.0015); 
                const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
                camera.position.z = 50;
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: false });
                renderer.setSize(width, height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                containerRef.current.appendChild(renderer.domElement);

                const texture = createSoftTexture();
                const particleCount = 4000; 
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const originalPositions = [];
                const velocities = [];

                for(let i = 0; i < particleCount; i++) {
                    const x = (Math.random() - 0.5) * 400;
                    const y = (Math.random() - 0.5) * 300;
                    const z = (Math.random() - 0.5) * 200; 
                    positions[i*3] = x; positions[i*3+1] = y; positions[i*3+2] = z;
                    originalPositions.push(x, y, z);
                    velocities.push({ x:0, y:0, z:0 });
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, map: texture, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending, depthWrite: false });
                const points = new THREE.Points(geometry, material);
                scene.add(points);

                const onMouseMove = (e) => {
                    const x = (e.clientX / window.innerWidth) * 2 - 1;
                    const y = -(e.clientY / window.innerHeight) * 2 + 1;
                    const vec = new THREE.Vector3(x, y, 0.5);
                    vec.unproject(camera);
                    const dir = vec.sub(camera.position).normalize();
                    const distance = -camera.position.z / dir.z;
                    const pos = camera.position.clone().add(dir.multiplyScalar(distance));
                    mouseRef.current = { x: pos.x, y: pos.y, z: pos.z };
                };
                window.addEventListener('mousemove', onMouseMove);
                const handleResize = () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); };
                window.addEventListener('resize', handleResize);

                let frameId;
                const animate = () => {
                    frameId = requestAnimationFrame(animate);
                    points.material.color.lerp(targetColorRef.current, 0.05);
                    const positions = geometry.attributes.position.array;
                    const mousePos = new THREE.Vector3(mouseRef.current.x, mouseRef.current.y, 0);
                    
                    for(let i = 0; i < particleCount; i++) {
                        const idx = i*3;
                        const px = positions[idx]; const py = positions[idx+1]; const pz = positions[idx+2];
                        const ox = originalPositions[idx]; const oy = originalPositions[idx+1]; const oz = originalPositions[idx+2];
                        const v = velocities[i];
                        const distSq = (px-mousePos.x)**2 + (py-mousePos.y)**2 + (pz-mousePos.z)**2;
                        if (distSq < 3600) { 
                            const dist = Math.sqrt(distSq);
                            const force = (60 - dist) / 60;
                            v.x += (mousePos.x - px) * force * 0.005;
                            v.y += (mousePos.y - py) * force * 0.005;
                            v.z += (mousePos.z - pz) * force * 0.005;
                        }
                        v.x += (ox - px) * 0.015; v.y += (oy - py) * 0.015; v.z += (oz - pz) * 0.015;
                        v.x *= 0.90; v.y *= 0.90; v.z *= 0.90;
                        positions[idx] += v.x; positions[idx+1] += v.y; positions[idx+2] += v.z;
                    }
                    geometry.attributes.position.needsUpdate = true;
                    renderer.render(scene, camera);
                };
                animate();

                return () => { 
                    window.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(frameId);
                    if (containerRef.current) containerRef.current.removeChild(renderer.domElement);
                    renderer.dispose();
                }
            }, []); 
            return <div ref={containerRef} className="fixed top-0 left-0 w-full h-full -z-10 bg-slate-950" />;
        };

        /* --- HUD NAVBAR --- */
        const NavBar = ({ setPage, currentPage }) => {
            const links = [{id:'home',l:'MAIN MENU'},{id:'pipelines',l:'MISSION SELECT'},{id:'lab',l:'TEST SERVER'},{id:'articles',l:'LOGS'},{id:'about',l:'PLAYER PROFILE'}];
            return (
                <nav className="fixed top-0 w-full z-50 bg-slate-900/80 backdrop-blur border-b border-cyan-900/50">
                    <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-2 font-bold text-white cursor-pointer" onClick={()=>setPage('home')}><Brain className="text-cyan-400" /> AI GAMEWORKS</div>
                        <div className="hidden md:flex gap-1">{links.map(l=><button key={l.id} onClick={()=>setPage(l.id)} className={`px-4 py-2 text-xs font-bold uppercase ${currentPage===l.id?'text-cyan-900 bg-cyan-400 clip-path-polygon':'text-slate-400 hover:text-white'}`}>{l.l}</button>)}</div>
                    </div>
                </nav>
            );
        };

        const PageTransition = ({ children, title }) => (
            <motion.div initial={{opacity:0, y:20}} animate={{opacity:1, y:0}} exit={{opacity:0}} className="min-h-screen pt-20">
                {children}
            </motion.div>
        );

        /* --- PAGES --- */
        const GalaxyMissionSelect = ({ setPage, setPipeline }) => {
            const [currentPhaseIdx, setCurrentPhaseIdx] = useState(0);
            const [hoverPhaseIdx, setHoverPhaseIdx] = useState(null);
            const [hoveredModule, setHoveredModule] = useState(null); 
            
            const phase = PHASES_CONFIG[currentPhaseIdx];
            const displayPhase = hoverPhaseIdx !== null ? PHASES_CONFIG[hoverPhaseIdx] : phase; 

            return (
                <PageTransition title="Mission Select">
                    <div className="relative w-full h-[60vh] overflow-hidden border-y border-slate-800/50 bg-slate-900/20">
                        <GalaxyScene 
                            currentPhaseIdx={currentPhaseIdx} 
                            hoverPhaseIdx={hoverPhaseIdx} 
                            onSelectModule={(id) => { setPipeline(id); setPage('pipeline-detail'); }} 
                            onChangePhase={(idx) => setCurrentPhaseIdx(idx)}
                            onHoverPhase={(idx) => setHoverPhaseIdx(idx)}
                            onHoverModule={setHoveredModule} 
                        />
                        
                        <div className="absolute top-8 left-8 pointer-events-none transition-all duration-300 z-20">
                            <div className="text-cyan-400 font-mono text-xs uppercase tracking-widest mb-2">
                                {hoverPhaseIdx !== null ? "TARGET SECTOR" : "CURRENT SECTOR"}
                            </div>
                            <h2 className="text-5xl font-black text-white mb-2 hud-text">{displayPhase.name}</h2>
                            <p className="text-slate-400 max-w-md text-lg">{displayPhase.desc}</p>
                            
                            <AnimatePresence>
                                {hoveredModule && (
                                    <motion.div 
                                        initial={{ x: -20, opacity: 0 }}
                                        animate={{ x: 0, opacity: 1 }}
                                        exit={{ x: -20, opacity: 0 }}
                                        className="mt-8 pointer-events-none"
                                    >
                                        <div className="text-xs text-yellow-400 font-mono uppercase tracking-widest mb-2 animate-pulse">
                                            <Target className="w-3 h-3 inline mr-1" /> TARGET LOCK ACQUIRED
                                        </div>
                                        <div className="p-4 bg-slate-900/90 border border-cyan-500/50 border-l-4 border-l-cyan-400 rounded shadow-[0_0_30px_rgba(34,211,238,0.3)] backdrop-blur-md max-w-xs">
                                            <div className="text-lg font-bold text-white mb-1">{hoveredModule.name}</div>
                                            <div className="text-xs text-slate-400 font-mono uppercase flex items-center gap-2">
                                                <span className="w-2 h-2 bg-cyan-500 rounded-full"></span>
                                                {hoveredModule.domainTitle}
                                            </div>
                                        </div>
                                    </motion.div>
                                )}
                            </AnimatePresence>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto px-4 mt-[-30px] relative z-30 flex justify-center">
                        <div className="bg-slate-900/90 backdrop-blur border border-slate-700 rounded-full p-2 shadow-2xl flex gap-2">
                            {PHASES_CONFIG.map((p, idx) => (
                                <button 
                                    key={p.id} 
                                    onClick={() => setCurrentPhaseIdx(idx)}
                                    onMouseEnter={() => setHoverPhaseIdx(idx)}
                                    onMouseLeave={() => setHoverPhaseIdx(null)}
                                    className={`px-6 py-3 rounded-full text-xs font-bold uppercase transition-all duration-300 ${
                                        idx === currentPhaseIdx 
                                            ? 'bg-cyan-600 text-white shadow-[0_0_20px_rgba(34,211,238,0.6)] scale-110' 
                                            : idx === hoverPhaseIdx 
                                                ? 'bg-slate-700 text-white scale-105' 
                                                : 'text-slate-500 hover:text-slate-300'
                                    }`}
                                >
                                    {p.name}
                                </button>
                            ))}
                        </div>
                    </div>
                </PageTransition>
            );
        };

        const Home = ({ setPage }) => (
            <PageTransition>
                <div className="flex flex-col items-center justify-center h-[80vh] text-center px-4">
                    <h1 className="text-8xl font-black text-white mb-4 tracking-tighter">AI <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600">GAMEWORKS</span></h1>
                    <p className="text-xl text-slate-400 mb-8">Revolutionizing Game Production Protocols</p>
                    <button onClick={()=>setPage('pipelines')} className="px-8 py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-full shadow-lg shadow-cyan-500/30 transition-all">START MISSION</button>
                </div>
            </PageTransition>
        );

        const PlayerProfile = () => <PageTransition title="Profile"><div className="text-center py-20 text-slate-500">Profile Module Active</div></PageTransition>;
        const LabPage = () => <PageTransition title="Test Server"><div className="text-center py-20 text-slate-500">Lab Module Active</div></PageTransition>;
        const ArticlesPage = () => <PageTransition title="Logs"><div className="text-center py-20 text-slate-500">Logs Module Active</div></PageTransition>;
        const SimplePage = ({title}) => <PageTransition title={title}><div className="text-center py-20 text-slate-500">Module Active</div></PageTransition>;

        const PipelineDetail = ({ pipelineId, goBack }) => {
            let data = DOMAINS_DATA[pipelineId];
            if (!data) { Object.entries(DOMAINS_DATA).forEach(([domainKey, domainData]) => { if (domainData.phase_modules.find(m => m.id === pipelineId)) { data = domainData; } }); }
            if (!data) return <div className="pt-32 text-center text-white">Data Loading... <button onClick={goBack}>Back</button></div>;
            return (
                <PageTransition>
                    <div className="max-w-6xl mx-auto px-4 pb-20 pt-8">
                        <button onClick={goBack} className="mb-6 text-slate-400 hover:text-white flex items-center uppercase text-xs font-bold tracking-widest"><ChevronLeft className="w-4 h-4 mr-1"/> Return to Galaxy</button>
                        <div className="relative bg-slate-900/80 border border-slate-700 rounded-2xl p-8 mb-8 overflow-hidden">
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-1/2 h-full energy-beam pointer-events-none opacity-30" />
                            <div className="relative z-10 flex flex-col items-center text-center">
                                <div className="p-4 bg-slate-800 rounded-full border border-cyan-500/50 text-cyan-400 mb-4 shadow-[0_0_30px_rgba(6,182,212,0.3)]">
                                    {React.cloneElement(data.icon, { size: 48 })}
                                </div>
                                <h1 className="text-4xl md:text-5xl font-black text-white mb-4">{data.title}</h1>
                                <p className="text-xl text-slate-300 max-w-2xl">{data.headerDesc}</p>
                                <div className="grid grid-cols-3 gap-6 mt-8 w-full max-w-3xl">
                                    {data.value && data.value.map((val, i) => (
                                        <div key={i} className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 text-center">
                                            <div className="text-xs text-slate-500 uppercase mb-1">{val.label}</div>
                                            <div className="text-3xl font-black text-white mb-1">{val.val}</div>
                                            <div className="text-[10px] text-cyan-400">{val.desc}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="grid md:grid-cols-3 gap-8">
                            <div className="col-span-2 space-y-8">
                                <div className="bg-slate-900/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Activity className="text-cyan-400"/> Operational Flow</h3>
                                    <div className="flex flex-wrap gap-3">
                                        {data.flow.map((step, i) => (
                                            <div key={i} className="flex items-center">
                                                <span className="bg-slate-800 border border-slate-600 px-4 py-2 rounded text-sm text-slate-200">{i+1}. {step}</span>
                                                {i < data.flow.length - 1 && <div className="w-4 h-0.5 bg-slate-700 mx-1"></div>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Zap className="text-yellow-400"/> Upgrade Analysis</h3>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-12 text-xs font-mono text-slate-500 uppercase mb-2">
                                            <div className="col-span-3">Metric</div>
                                            <div className="col-span-4">Traditional</div>
                                            <div className="col-span-5">AI Enhanced</div>
                                        </div>
                                        {data.comparison.map((c, i) => (
                                            <div key={i} className="grid grid-cols-12 text-sm border-b border-slate-800 pb-3 items-center last:border-0">
                                                <div className="col-span-3 text-slate-300 font-bold">{c.dimension}</div>
                                                <div className="col-span-4 text-slate-500 line-through">{c.trad}</div>
                                                <div className="col-span-5 text-cyan-400 font-bold flex items-center gap-2">
                                                    <CheckCircle2 className="w-4 h-4" /> {c.ai}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="col-span-1 space-y-6">
                                <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase mb-4">Tech Stack</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {data.tools.map(t => <span key={t} className="px-2 py-1 bg-cyan-950 text-cyan-400 text-xs rounded border border-cyan-900">{t}</span>)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </PageTransition>
            );
        };

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [currentPipeline, setCurrentPipeline] = useState(null);
            useEffect(() => { window.scrollTo(0, 0); }, [currentPage]);
            const particleMode = useMemo(() => {
                if (currentPage === 'home') return 'home';
                return 'default';
            }, [currentPage]);
            return (
                <div className="min-h-screen text-slate-100 selection:bg-cyan-500/30">
                    <ThreeBackground mode={particleMode} />
                    <NavBar setPage={setCurrentPage} currentPage={currentPage} />
                    <AnimatePresence mode="wait">
                        {currentPage === 'home' && <Home key="home" setPage={setCurrentPage} />}
                        {currentPage === 'pipelines' && <GalaxyMissionSelect key="pipelines" setPage={setCurrentPage} setPipeline={setCurrentPipeline} />}
                        {currentPage === 'pipeline-detail' && <PipelineDetail key="detail" pipelineId={currentPipeline} goBack={()=>setCurrentPage('pipelines')} />}
                        {['lab','about','articles','toolbox'].includes(currentPage) && (
                            <PageTransition key="wip">
                                <div className="pt-32 text-center text-slate-500">Module: {currentPage.toUpperCase()} // System Online</div>
                            </PageTransition>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>