<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Gameworks: Creation Galaxy</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        html { font-size: 18px; }
        body { margin: 0; overflow-x: hidden; background-color: #020617; font-family: 'Inter', sans-serif; }
        .clip-path-polygon {
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #334155; }
        
        @keyframes beam-flow {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 100%; }
        }
        .energy-beam {
            background: linear-gradient(to bottom, transparent, rgba(34, 211, 238, 0.5) 50%, transparent);
            background-size: 100% 200%;
            animation: beam-flow 2s linear infinite;
        }
    </style>

    <!-- 3. Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0",
        "three": "https://esm.sh/three@0.160.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';
        import * as THREE from 'three';
        import { 
            Brain, Layers, Gamepad2, Users, Activity, Code, Box, Music, Video, 
            Search, Globe, BarChart, Database, Zap, ChevronRight, ArrowRight, 
            Menu, X, Mail, Linkedin, Twitter, Cpu, FlaskConical, FileText, 
            Wrench, MessageSquare, Tag, Star, Lock, Unlock, Play, ChevronLeft,
            Shield, Sword, Scroll, Map, TestTube, Microscope, Terminal, Calendar,
            Server, Orbit, Rocket, Satellite, Timer, TrendingUp, CheckCircle2,
            Target
        } from 'lucide-react';

        /* --- DATA --- */
        const PHASES_CONFIG = [
            { id: "preprod", name: "Pre-production", desc: "The Brain: Ideation & Raw Concepts", color: 0xd946ef, type: "brain", x: -90 }, 
            { id: "production", name: "Production", desc: "The Construct: Rough but Forming", color: 0xf97316, type: "construct", x: -45 },
            { id: "qa", name: "QA & Polish", desc: "The Sphere: Polished Perfection", color: 0x10b981, type: "perfect", x: 0 },
            { id: "liveops", name: "LiveOps", desc: "The Nexus: Data Stream & Updates", color: 0x8b5cf6, type: "nexus", x: 45 },
            { id: "future", name: "Future Tech", desc: "The Ascendant: Enhanced & Winged", color: 0x06b6d4, type: "winged", x: 90 }
        ];

        const DOMAINS_DATA = {
            "design": { title: "Game Design / Narrative", icon: <Gamepad2 />, phase_modules: [{ id: "design_concept", phase: "preprod", name: "AI Design Brainstorming" }, { id: "design_level", phase: "preprod", name: "Level Blockout Gen" }, { id: "design_narrative", phase: "preprod", name: "AI Narrative Branching" }], headerDesc: "AI as the designer's 'Second Brain'.", tools: ["Claude 3.5", "Ludo.ai"], flow: ["Goals", "Combo Exploration", "Blockout", "Narrative", "Analysis"], comparison: [{ dimension: "Brainstorming", trad: "Limited", ai: "Massive", score: 92 }], value: [{ label: "Efficiency", val: "50%", desc: "Faster iteration" }], roles: { ai: "Divergent", human: "Core Experience" } },
            "art": { title: "Art AI Production", icon: <Box />, phase_modules: [{ id: "art_concept", phase: "preprod", name: "AI Concept Art" }, { id: "art_production", phase: "production", name: "Asset Batch Gen" }, { id: "art_texture", phase: "production", name: "AI Texturing" }], headerDesc: "Accelerating style exploration.", tools: ["Stable Diffusion", "Midjourney"], flow: ["Brief", "Moodboard", "Concept", "Multi-view", "3D", "QA"], comparison: [{ dimension: "Exploration", trad: "Slow", ai: "Rapid", score: 90 }], value: [{ label: "Time", val: "-70%", desc: "Lock direction" }], roles: { ai: "Drafting", human: "Direction" } },
            "audio": { title: "Audio AI Pipeline", icon: <Music />, phase_modules: [{ id: "audio_temp", phase: "preprod", name: "Temp Audio / TTS" }, { id: "audio_prod", phase: "production", name: "AI BGM & SFX" }], headerDesc: "Accelerating auditory creation.", tools: ["Suno AI", "ElevenLabs"], flow: ["Direction", "Placeholder", "BGM", "SFX", "VO"], comparison: [{ dimension: "Placeholders", trad: "Manual", ai: "Instant", score: 95 }], value: [{ label: "Immersion", val: "Instant", desc: "Prototype phase" }], roles: { ai: "Placeholders", human: "Emotion" } },
            "3d_asset": { title: "3D Asset AI", icon: <Box />, phase_modules: [{id:"3d_proto", phase:"preprod", name:"Prototype 3D"}, {id:"3d_prod", phase:"production", name:"High-Res 3D Gen"}], headerDesc: "Streamlining 3D production.", tools: ["Meshy", "CSM"], flow: ["Asset Req", "Draft Gen", "Retopo", "UV", "Material"], comparison: [{dimension:"Drafting", trad:"Manual", ai:"Auto", score:85}], value: [{label:"Speed", val:"5x", desc:"Faster base mesh"}], roles: {ai:"Drafting", human:"Polish"} },
            "pv": { title: "PV / Trailer", icon: <Video />, phase_modules: [{id:"pv_draft", phase:"preprod", name:"PV Draft / Storyboard"}, {id:"pv_final", phase:"production", name:"Final Trailer Gen"}], headerDesc: "Speed up video workflow.", tools: ["Runway", "Pika"], flow: ["Script", "Storyboard", "Gen Video", "Edit"], comparison: [{dimension:"Storyboard", trad:"Draw", ai:"Gen", score:90}], value: [{label:"Cost", val:"Low", desc:"Cheap iteration"}], roles: {ai:"Storyboard", human:"Editing"} },
            "animation": { title: "Animation AI", icon: <Activity />, phase_modules: [{id:"anim_prod", phase:"production", name:"AI Animation Cleanup"}, {id:"anim_retarget", phase:"production", name:"Auto Retargeting"}], headerDesc: "Automating animation cleanup.", tools: ["Cascadeur"], flow: ["Mocap", "Cleanup", "Retarget"], comparison: [{dimension:"Cleanup", trad:"Manual", ai:"Auto", score:88}], value: [{label:"Efficiency", val:"High", desc:"Reduce manual keyframing"}], roles: {ai:"", human:""} },
            "qa": { title: "AI QA", icon: <Search />, phase_modules: [{id:"qa_bot", phase:"qa", name:"Automated Regression Bots"}], headerDesc: "Intelligent verification bots.", tools: ["Appium"], flow: ["Script", "Run Bot", "Report"], comparison: [{dimension:"Regression", trad:"Manual", ai:"Auto", score:95}], value: [{label:"Coverage", val:"100%", desc:"24/7 Testing"}], roles: {ai:"", human:""} },
            "localization": { title: "Localization", icon: <Globe />, phase_modules: [{id:"loc_ai", phase:"qa", name:"AI Contextual Trans"}], headerDesc: "Efficient multi-lang workflow.", tools: ["DeepL"], flow: ["Extract", "Translate", "Review"], comparison: [{dimension:"Speed", trad:"Slow", ai:"Fast", score:92}], value: [{label:"Speed", val:"10x", desc:"Instant draft"}], roles: {ai:"", human:""} },
            "tools": { title: "Engine Tools", icon: <Code />, phase_modules: [{id:"tools_gen", phase:"qa", name:"Copilot for Devs"}], headerDesc: "Supercharging engineering.", tools: ["Copilot"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "liveops": { title: "LiveOps AI", icon: <Zap />, phase_modules: [{id:"live_plan", phase:"liveops", name:"AI Event Planning"}], headerDesc: "Data-driven operations.", tools: ["Python"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "monetization": { title: "Monetization", icon: <BarChart />, phase_modules: [{id:"money_model", phase:"liveops", name:"Player LTV Modeling"}], headerDesc: "Data-driven economy.", tools: ["TensorFlow"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "npc": { title: "Smart NPC", icon: <Users />, phase_modules: [{id:"npc_brain", phase:"future", name:"Generative NPC Brain"}], headerDesc: "Next-gen intelligent NPCs.", tools: ["Inworld"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "proc_gen": { title: "Procedural Gen", icon: <Layers />, phase_modules: [{id:"pcg_world", phase:"future", name:"Infinite World Gen"}], headerDesc: "Generating playable worlds.", tools: ["PCG"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
            "research": { title: "AI Research", icon: <Brain />, phase_modules: [{id:"rnd_poc", phase:"future", name:"Tech Radar & PoC"}], headerDesc: "Tech assessment loop.", tools: ["ArXiv"], flow: [], comparison: [], value: [], roles: {ai:"", human:""} },
        };

        const LAB_EXPERIMENTS = [ { id: 1, title: "Style Consistency", code: "PRJ-A", status: "COMPLETED", statusColor: "text-green-400 border-green-500", problem: "Style drift in SD models.", method: "LoRA + ControlNet.", conclusion: "Locks 80% features.", impact: "Iteration +40%." }, { id: 2, title: "NPC Behavior Tree", code: "PRJ-B", status: "BETA", statusColor: "text-yellow-400 border-yellow-500", problem: "Complex BT authoring.", method: "LLM to JSON.", conclusion: "90% accuracy simple logic.", impact: "Minutes prototyping." }, { id: 3, title: "Auto Regression", code: "PRJ-C", status: "ALPHA", statusColor: "text-red-400 border-red-500", problem: "Manual smoke tests.", method: "CV Agent.", conclusion: "95% UI coverage.", impact: "Freed 2 QA." } ];
        const ARTICLES_LIST = [ { id: 1, title: "AI Workflow Shift", date: "2023-10-15", category: "OPINION", summary: "Artists becoming curators.", tags: ["Art"] }, { id: 2, title: "Data-Driven Design", date: "2023-11-02", category: "TECH", summary: "RL Agents for balance.", tags: ["Design"] }, { id: 3, title: "Prompt Engineering", date: "2023-12-10", category: "ENGINEERING", summary: "Productionizing LLMs.", tags: ["DevOps"] } ];

        const getModulesByPhase = (phaseId) => {
            const modules = [];
            Object.entries(DOMAINS_DATA).forEach(([domainKey, data]) => {
                data.phase_modules.forEach(mod => {
                    if (mod.phase === phaseId) {
                        modules.push({ ...mod, domainKey, icon: data.icon, domainTitle: data.title });
                    }
                });
            });
            return modules;
        };

        /* --- THREE.JS GALAXY COMPONENT --- */
        const GalaxyScene = ({ currentPhaseIdx, onSelectModule, onChangePhase, hoverPhaseIdx, onHoverModule, onHoverPhase }) => {
            const containerRef = useRef(null);
            const requestRef = useRef();
            const planetGroupRef = useRef(null);
            const satelliteGroupRef = useRef(null);
            const satellitesRef = useRef([]);
            const mouseRef = useRef({ x: 0, y: 0 });
            const raycasterRef = useRef(new THREE.Raycaster());
            const cameraRef = useRef(null);
            
            const callbacksRef = useRef({ onSelectModule, onChangePhase, onHoverModule, onHoverPhase });
            const stateRef = useRef({ currentPhaseIdx, hoverPhaseIdx, lastHoveredModuleId: null });

            useEffect(() => {
                stateRef.current.currentPhaseIdx = currentPhaseIdx;
                stateRef.current.hoverPhaseIdx = hoverPhaseIdx;
                callbacksRef.current = { onSelectModule, onChangePhase, onHoverModule, onHoverPhase };
            }, [currentPhaseIdx, hoverPhaseIdx, onSelectModule, onChangePhase, onHoverModule, onHoverPhase]);

            const createSatelliteMesh = (domainKey, color) => {
                let geo;
                if (domainKey === 'art' || domainKey === '3d_asset') geo = new THREE.IcosahedronGeometry(1.5, 0); 
                else if (domainKey === 'design' || domainKey === 'proc_gen') geo = new THREE.BoxGeometry(2.2, 2.2, 2.2);
                else if (domainKey === 'audio') geo = new THREE.TorusGeometry(1.2, 0.4, 8, 16);
                else if (domainKey === 'animation' || domainKey === 'npc') geo = new THREE.OctahedronGeometry(1.5, 0); 
                else if (domainKey === 'qa' || domainKey === 'tools' || domainKey === 'localization') geo = new THREE.BoxGeometry(1.8, 1.8, 1.8); 
                else if (domainKey === 'monetization' || domainKey === 'liveops') geo = new THREE.ConeGeometry(1.2, 2.5, 4);
                else geo = new THREE.SphereGeometry(1.2, 16, 16);
                
                const isWireframe = (domainKey === 'qa' || domainKey === 'tools');
                const mat = new THREE.MeshStandardMaterial({ 
                    color: 0xffffff, emissive: color, emissiveIntensity: 0.5, flatShading: true, roughness: 0.3, metalness: 0.8, wireframe: isWireframe
                });
                return new THREE.Mesh(geo, mat);
            };

            useEffect(() => {
                if (!containerRef.current) return;

                const width = containerRef.current.clientWidth || window.innerWidth;
                const height = containerRef.current.clientHeight || window.innerHeight;
                const scene = new THREE.Scene();
                
                const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
                camera.position.set(0, 15, 85); 
                camera.lookAt(0, 0, 0);
                cameraRef.current = camera;

                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(width, height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                containerRef.current.appendChild(renderer.domElement);

                const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
                scene.add(ambientLight);
                const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
                dirLight.position.set(20, 20, 30);
                scene.add(dirLight);
                const pointLight = new THREE.PointLight(PHASES_CONFIG[0].color, 1.5, 100);
                pointLight.position.set(0, 0, 15);
                scene.add(pointLight);
                
                const allPlanetsGroup = new THREE.Group();
                scene.add(allPlanetsGroup);
                planetGroupRef.current = allPlanetsGroup;

                PHASES_CONFIG.forEach((cfg, idx) => {
                    const pGroup = new THREE.Group();
                    pGroup.position.set(cfg.x, 0, 0);
                    pGroup.userData = { id: idx, name: cfg.name };

                    let mesh;
                    if (cfg.type === 'brain') {
                        mesh = new THREE.Mesh(
                            new THREE.TorusKnotGeometry(3.5, 1.2, 100, 16, 3, 4),
                            new THREE.MeshStandardMaterial({ color: cfg.color, roughness: 0.5, metalness: 0.1, emissive: 0x550055, emissiveIntensity: 0.2 })
                        );
                        pGroup.add(mesh);
                    } else if (cfg.type === 'construct') {
                        mesh = new THREE.Mesh(
                            new THREE.IcosahedronGeometry(4.5, 0),
                            new THREE.MeshStandardMaterial({ color: cfg.color, flatShading: true, roughness: 0.8, metalness: 0.3 })
                        );
                        const cage = new THREE.Mesh(
                            new THREE.IcosahedronGeometry(5.5, 1),
                            new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true, transparent: true, opacity: 0.2 })
                        );
                        cage.userData = { rotateSpeed: -0.002 };
                        pGroup.add(mesh); pGroup.add(cage);
                    } else if (cfg.type === 'perfect') {
                        mesh = new THREE.Mesh(
                            new THREE.SphereGeometry(4.8, 64, 64),
                            new THREE.MeshPhysicalMaterial({ color: cfg.color, roughness: 0.1, metalness: 0.2, clearcoat: 1.0, clearcoatRoughness: 0.1 })
                        );
                        const shield = new THREE.Mesh(
                            new THREE.SphereGeometry(6.2, 32, 32),
                            new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.15, side: THREE.DoubleSide })
                        );
                        pGroup.add(mesh); pGroup.add(shield);
                    } else if (cfg.type === 'nexus') {
                         mesh = new THREE.Mesh(new THREE.TorusKnotGeometry(3.8, 1.2, 100, 16), new THREE.MeshNormalMaterial({ flatShading: false }));
                         const ring1 = new THREE.Mesh(new THREE.TorusGeometry(7.5, 0.1, 16, 100), new THREE.MeshBasicMaterial({ color: cfg.color }));
                         ring1.rotation.x = Math.PI/2.5;
                         pGroup.add(mesh); pGroup.add(ring1);
                    } else if (cfg.type === 'winged') {
                        const core = new THREE.Mesh(new THREE.OctahedronGeometry(4.0, 0), new THREE.MeshStandardMaterial({ color: 0x000000, emissive: cfg.color, emissiveIntensity: 0.8, wireframe: true }));
                        const wingGeo = new THREE.BoxGeometry(1, 14, 3);
                        const wingMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2, metalness: 0.9 });
                        const wingL = new THREE.Mesh(wingGeo, wingMat); wingL.position.set(-7, 0, 0); wingL.rotation.z = 0.2;
                        const wingR = new THREE.Mesh(wingGeo, wingMat); wingR.position.set(7, 0, 0); wingR.rotation.z = -0.2;
                        const rotator = new THREE.Group();
                        rotator.add(core); rotator.add(wingL); rotator.add(wingR);
                        rotator.userData = { rotateSpeed: 0.01 }; 
                        pGroup.add(rotator);
                    }
                    allPlanetsGroup.add(pGroup);
                });

                // Satellites Group
                const satelliteGroup = new THREE.Group();
                scene.add(satelliteGroup);
                satelliteGroupRef.current = satelliteGroup;
                satellitesRef.current = [];

                // Initial Build
                const rebuildSatellites = (phaseId, color) => {
                    if (!satelliteGroupRef.current) return;
                    
                    // Clear existing
                    while(satelliteGroupRef.current.children.length > 0){ 
                        const obj = satelliteGroupRef.current.children[0];
                        satelliteGroupRef.current.remove(obj);
                        if (obj.geometry) obj.geometry.dispose();
                        if (obj.material) obj.material.dispose();
                    }
                    satellitesRef.current = [];
                    
                    const mods = getModulesByPhase(phaseId);
                    mods.forEach((mod, i) => {
                        const angle = (i / mods.length) * Math.PI * 2;
                        const radius = 26; 
                        const x = Math.cos(angle) * radius;
                        const z = Math.sin(angle) * radius;
                        
                        const satMesh = createSatelliteMesh(mod.domainKey, color);
                        satMesh.position.set(x, 0, z);
                        satMesh.userData = { 
                            id: mod.id, 
                            angle: angle, 
                            radius: radius, 
                            speed: 0.0005, 
                            name: mod.name, 
                            domainTitle: mod.domainTitle 
                        };
                        
                        const orbitGeo = new THREE.RingGeometry(radius - 0.1, radius + 0.1, 128);
                        const orbitMat = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.05 });
                        const orbitRing = new THREE.Mesh(orbitGeo, orbitMat);
                        orbitRing.rotation.x = Math.PI / 2;
                        satelliteGroupRef.current.add(orbitRing);

                        satelliteGroupRef.current.add(satMesh);
                        satellitesRef.current.push(satMesh);
                    });
                };

                rebuildSatellites(PHASES_CONFIG[0].id, PHASES_CONFIG[0].color);

                const raycaster = new THREE.Raycaster();
                
                const onMouseMove = (e) => {
                    const rect = containerRef.current.getBoundingClientRect();
                    mouseRef.current.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
                    mouseRef.current.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
                };

                const onClick = () => {
                    raycaster.setFromCamera(mouseRef.current, camera);
                    const satIntersects = raycaster.intersectObjects(satellitesRef.current);
                    if (satIntersects.length > 0) {
                        callbacksRef.current.onSelectModule(satIntersects[0].object.userData.id);
                        return;
                    }
                    const planetIntersects = raycaster.intersectObjects(allPlanetsGroup.children, true);
                    if (planetIntersects.length > 0) {
                        let target = planetIntersects[0].object;
                        while(target.parent !== allPlanetsGroup) { target = target.parent; }
                        callbacksRef.current.onChangePhase(target.userData.id); 
                    }
                };

                const resizeObserver = new ResizeObserver((entries) => {
                    for (let entry of entries) {
                        const { width, height } = entry.contentRect;
                        if (width > 0 && height > 0) {
                            camera.aspect = width / height;
                            camera.updateProjectionMatrix();
                            renderer.setSize(width, height);
                        }
                    }
                });
                resizeObserver.observe(containerRef.current);

                containerRef.current.addEventListener('mousemove', onMouseMove);
                containerRef.current.addEventListener('click', onClick);

                let lastRenderedPhaseIdx = 0;

                const animate = () => {
                    requestRef.current = requestAnimationFrame(animate);
                    const time = Date.now() * 0.001;
                    const { currentPhaseIdx, hoverPhaseIdx } = stateRef.current;

                    if (lastRenderedPhaseIdx !== currentPhaseIdx) {
                        lastRenderedPhaseIdx = currentPhaseIdx;
                        const p = PHASES_CONFIG[currentPhaseIdx];
                        rebuildSatellites(p.id, p.color);
                        pointLight.color.setHex(p.color);
                    }

                    if (planetGroupRef.current) {
                        const activePlanetX = PHASES_CONFIG[currentPhaseIdx].x;
                        const targetGroupX = -activePlanetX;
                        planetGroupRef.current.position.x += (targetGroupX - planetGroupRef.current.position.x) * 0.08;

                        raycaster.setFromCamera(mouseRef.current, camera);
                        const planetIntersects = raycaster.intersectObjects(allPlanetsGroup.children, true);
                        
                        let hoveredPlanetId = -1;
                        if (planetIntersects.length > 0) {
                             let target = planetIntersects[0].object;
                             while(target.parent !== allPlanetsGroup) target = target.parent;
                             hoveredPlanetId = target.userData.id;
                             document.body.style.cursor = 'pointer';
                             if (callbacksRef.current.onHoverPhase && hoveredPlanetId !== currentPhaseIdx) {
                                 callbacksRef.current.onHoverPhase(hoveredPlanetId);
                             }
                        } else {
                            const satIntersects = raycaster.intersectObjects(satellitesRef.current);
                            document.body.style.cursor = satIntersects.length > 0 ? 'pointer' : 'default';
                        }

                        planetGroupRef.current.children.forEach((pGroup, i) => {
                            pGroup.rotation.y += 0.002;
                            pGroup.children.forEach(child => {
                                if (child.userData.rotateSpeed) {
                                    child.rotation.y += child.userData.rotateSpeed;
                                    child.rotation.x += child.userData.rotateSpeed * 0.5;
                                }
                            });
                            if (pGroup.userData.pulse) {
                                const scale = 1 + Math.sin(time * 3) * 0.1;
                                if (pGroup.children[1]) pGroup.children[1].scale.set(scale, scale, scale);
                            }

                            let targetScale = i === currentPhaseIdx ? 1.0 : 0.8;
                            let targetOpacity = i === currentPhaseIdx ? 1.0 : 0.3; 
                            
                            if (hoveredPlanetId !== -1) {
                                if (i === hoveredPlanetId) {
                                    targetScale = 1.2; 
                                    targetOpacity = 1.0;
                                    pGroup.rotation.y += 0.02; 
                                } else {
                                    targetScale = 0.6; 
                                    targetOpacity = 0.1; 
                                }
                            } else if (hoverPhaseIdx !== null) {
                                if (i === hoverPhaseIdx) {
                                    targetScale = 1.2;
                                    targetOpacity = 1.0;
                                } else {
                                    targetScale = 0.6;
                                    targetOpacity = 0.1;
                                }
                            }

                            pGroup.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                            
                            pGroup.traverse(child => {
                                if (child.isMesh && child.material) {
                                    if (child.material.emissive) {
                                        child.material.emissiveIntensity = THREE.MathUtils.lerp(child.material.emissiveIntensity, targetOpacity * 0.8, 0.1);
                                    }
                                }
                            });
                        });
                    }

                    satellitesRef.current.forEach((sat) => {
                        sat.userData.angle += sat.userData.speed;
                        sat.position.x = Math.cos(sat.userData.angle) * sat.userData.radius;
                        sat.position.z = Math.sin(sat.userData.angle) * sat.userData.radius;
                        sat.rotation.x += 0.002; 
                        sat.rotation.y += 0.002; 
                        
                        const satIntersects = raycaster.intersectObject(sat);
                        if (satIntersects.length > 0) {
                             sat.scale.lerp(new THREE.Vector3(1.5, 1.5, 1.5), 0.2);
                             sat.material.emissiveIntensity = 2.0;
                             if (stateRef.current.lastHoveredModuleId !== sat.userData.id) {
                                 stateRef.current.lastHoveredModuleId = sat.userData.id;
                                 if (callbacksRef.current.onHoverModule) callbacksRef.current.onHoverModule(sat.userData);
                             }
                        } else {
                             sat.scale.lerp(new THREE.Vector3(1, 1, 1), 0.1);
                             sat.material.emissiveIntensity = 0.5;
                        }
                    });

                    if (raycaster.intersectObjects(satellitesRef.current).length === 0 && stateRef.current.lastHoveredModuleId !== null) {
                        stateRef.current.lastHoveredModuleId = null;
                        if (callbacksRef.current.onHoverModule) callbacksRef.current.onHoverModule(null);
                    }

                    const mX = (mouseRef.current.x / window.innerWidth - 0.5) * 2;
                    const mY = (mouseRef.current.y / window.innerHeight - 0.5) * 2;
                    camera.position.x += (mX * 5 - camera.position.x) * 0.05;
                    camera.position.y += ((-mY * 5 + 15) - camera.position.y) * 0.05;
                    camera.lookAt(0, 0, 0);

                    renderer.render(scene, camera);
                };
                animate();

                return () => {
                    resizeObserver.disconnect();
                    if (containerRef.current) {
                        containerRef.current.removeEventListener('mousemove', onMouseMove);
                        containerRef.current.removeEventListener('click', onClick);
                        if (renderer.domElement.parentNode) renderer.domElement.parentNode.removeChild(renderer.domElement);
                    }
                    cancelAnimationFrame(requestRef.current);
                };
            }, []); 

            return <div ref={containerRef} className="w-full h-[70vh] relative z-10" />; 
        };

        /* --- BACKGROUND PARTICLES --- */
        const createSoftTexture = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.4, 'rgba(255, 255, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = gradient; ctx.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        };

        const ThreeBackground = ({ mode }) => {
            const containerRef = useRef(null);
            const mouseRef = useRef({ x: 10000, y: 10000 }); 
            const targetColorRef = useRef(new THREE.Color(0x67e8f9));

            useEffect(() => {
                let hex = 0x67e8f9;
                switch(mode) {
                    case 'art': hex = 0xf472b6; break;
                    case 'animation': hex = 0xfacc15; break;
                    case 'qa': hex = 0x4ade80; break;
                    case 'design': hex = 0xc084fc; break;
                    case 'audio': hex = 0x3b82f6; break;
                }
                targetColorRef.current.setHex(hex);
            }, [mode]);

            useEffect(() => {
                if (!containerRef.current) return;
                const width = window.innerWidth;
                const height = window.innerHeight;
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x020617, 0.0015); 
                const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
                camera.position.z = 50;
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: false });
                renderer.setSize(width, height);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                containerRef.current.appendChild(renderer.domElement);

                const texture = createSoftTexture();
                const particleCount = 4000; 
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const originalPositions = [];
                const velocities = [];

                for(let i = 0; i < particleCount; i++) {
                    const x = (Math.random() - 0.5) * 400;
                    const y = (Math.random() - 0.5) * 300;
                    const z = (Math.random() - 0.5) * 200; 
                    positions[i*3] = x; positions[i*3+1] = y; positions[i*3+2] = z;
                    originalPositions.push(x, y, z);
                    velocities.push({ x:0, y:0, z:0 });
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5, map: texture, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending, depthWrite: false });
                const points = new THREE.Points(geometry, material);
                scene.add(points);

                const onMouseMove = (e) => {
                    const x = (e.clientX / window.innerWidth) * 2 - 1;
                    const y = -(e.clientY / window.innerHeight) * 2 + 1;
                    const vec = new THREE.Vector3(x, y, 0.5);
                    vec.unproject(camera);
                    const dir = vec.sub(camera.position).normalize();
                    const distance = -camera.position.z / dir.z;
                    const pos = camera.position.clone().add(dir.multiplyScalar(distance));
                    mouseRef.current = { x: pos.x, y: pos.y, z: pos.z };
                };
                window.addEventListener('mousemove', onMouseMove);
                const handleResize = () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); };
                window.addEventListener('resize', handleResize);

                let frameId;
                const animate = () => {
                    frameId = requestAnimationFrame(animate);
                    points.material.color.lerp(targetColorRef.current, 0.05);
                    const positions = geometry.attributes.position.array;
                    const mousePos = new THREE.Vector3(mouseRef.current.x, mouseRef.current.y, 0);
                    
                    for(let i = 0; i < particleCount; i++) {
                        const idx = i*3;
                        const px = positions[idx]; const py = positions[idx+1]; const pz = positions[idx+2];
                        const ox = originalPositions[idx]; const oy = originalPositions[idx+1]; const oz = originalPositions[idx+2];
                        const v = velocities[i];
                        
                        // Physics: Mouse Attraction
                        const distSq = (px-mousePos.x)**2 + (py-mousePos.y)**2 + (pz-mousePos.z)**2;
                        if (distSq < 3600) { 
                            const dist = Math.sqrt(distSq);
                            const force = (60 - dist) / 60;
                            v.x += (mousePos.x - px) * force * 0.005;
                            v.y += (mousePos.y - py) * force * 0.005;
                            v.z += (mousePos.z - pz) * force * 0.005;
                        }
                        
                        // Physics: Spring back
                        v.x += (ox - px) * 0.015; v.y += (oy - py) * 0.015; v.z += (oz - pz) * 0.015;
                        // Physics: Damping
                        v.x *= 0.90; v.y *= 0.90; v.z *= 0.90;
                        
                        positions[idx] += v.x; positions[idx+1] += v.y; positions[idx+2] += v.z;
                    }
                    geometry.attributes.position.needsUpdate = true;
                    renderer.render(scene, camera);
                };
                animate();

                return () => { 
                    window.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('resize', handleResize);
                    cancelAnimationFrame(frameId);
                    if (containerRef.current) containerRef.current.removeChild(renderer.domElement);
                    renderer.dispose();
                }
            }, []); 
            return <div ref={containerRef} className="fixed top-0 left-0 w-full h-full -z-10 bg-slate-950" />;
        };

        /* --- HUD NAVBAR --- */
        const NavBar = ({ setPage, currentPage }) => {
            const [isOpen, setIsOpen] = useState(false);
            const links = [
                { id: 'home', label: 'MAIN MENU' },
                { id: 'pipelines', label: 'MISSION SELECT' }, 
                { id: 'lab', label: 'TEST SERVER' }, 
                { id: 'articles', label: 'LOGS' },
                { id: 'about', label: 'PLAYER PROFILE' }, 
            ];

            return (
                <motion.nav 
                initial={{ y: -100 }} animate={{ y: 0 }} transition={{ type: 'spring', stiffness: 100 }}
                className="fixed top-0 w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-cyan-900/50"
                >
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                    <div className="flex items-center cursor-pointer group" onClick={() => setPage('home')}>
                        <div className="relative">
                        <Brain className="h-8 w-8 text-cyan-400 group-hover:animate-pulse" />
                        <span className="absolute -top-1 -right-1 flex h-2 w-2">
                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-2 w-2 bg-cyan-500"></span>
                        </span>
                        </div>
                        <div className="ml-3 flex flex-col">
                        <span className="text-xl font-bold text-white tracking-widest font-mono group-hover:text-cyan-400 transition-colors">AI GAMEWORKS</span>
                        <span className="text-xs text-cyan-500/70 tracking-[0.2em] font-mono">SYSTEM ONLINE</span>
                        </div>
                    </div>
                    
                    <div className="hidden md:block">
                        <div className="ml-10 flex items-baseline space-x-1">
                        {links.map((link) => (
                            <button
                            key={link.id}
                            onClick={() => setPage(link.id)}
                            className={`relative px-4 py-2 text-sm font-bold font-mono tracking-wider transition-all overflow-hidden group ${
                                currentPage === link.id 
                                ? 'text-cyan-900 bg-cyan-400 clip-path-polygon' 
                                : 'text-slate-400 hover:text-cyan-400 hover:bg-slate-800'
                            }`}
                            style={{ clipPath: 'polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%)' }}
                            >
                            {link.label}
                            {currentPage === link.id && (
                                <motion.div layoutId="underline" className="absolute bottom-0 left-0 w-full h-0.5 bg-cyan-200" />
                            )}
                            </button>
                        ))}
                        </div>
                    </div>
                    <div className="-mr-2 flex md:hidden">
                        <button onClick={() => setIsOpen(!isOpen)} className="text-cyan-400 p-2 border border-cyan-900 rounded bg-slate-800/50">
                        {isOpen ? <X className="h-6 w-6" /> : <Menu className="h-6 w-6" />}
                        </button>
                    </div>
                    </div>
                </div>
                {/* Mobile Menu */}
                {isOpen && (
                    <div className="md:hidden bg-slate-900 border-b border-cyan-900/50">
                        <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                            {links.map((link) => (
                                <button
                                    key={link.id}
                                    onClick={() => { setPage(link.id); setIsOpen(false); }}
                                    className="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-slate-300 hover:text-white hover:bg-slate-800"
                                >
                                    {link.label}
                                </button>
                            ))}
                        </div>
                    </div>
                )}
                </motion.nav>
            );
        };

        /* --- PAGE TRANSITION --- */
        const PageTransition = ({ children, title, subtitle }) => {
            return (
                <motion.div
                initial={{ opacity: 0, scale: 0.95, filter: "blur(10px)" }}
                animate={{ opacity: 1, scale: 1, filter: "blur(0px)" }}
                exit={{ opacity: 0, scale: 1.05, filter: "blur(5px)" }}
                transition={{ duration: 0.4, ease: "easeOut" }}
                className="min-h-screen pt-20"
                >
                <motion.div 
                    initial={{ scaleX: 0 }} 
                    animate={{ scaleX: 1 }} 
                    transition={{ duration: 0.6, ease: "circOut" }}
                    className="fixed top-16 left-0 h-0.5 w-full bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 origin-left z-40" 
                />
                {title && (
                    <div className="max-w-7xl mx-auto px-4 mb-8 flex items-center justify-between border-b border-slate-700/50 pb-4">
                    <div>
                        <div className="flex items-center gap-2 text-xs font-mono text-cyan-500 tracking-widest uppercase mb-1">
                        <Activity className="w-3 h-3" /> System Status: Normal
                        </div>
                        <h1 className="text-3xl md:text-4xl font-black text-white tracking-tight uppercase flex items-center gap-2">
                        <span className="text-cyan-400">/</span> {title}
                        </h1>
                    </div>
                    {subtitle && (
                        <div className="hidden md:block text-right">
                        <div className="text-sm text-slate-500 font-mono uppercase tracking-wider">Current Objective</div>
                        <div className="text-base text-slate-300 font-semibold max-w-xs">{subtitle}</div>
                        </div>
                    )}
                    </div>
                )}
                {children}
                </motion.div>
            );
        };

        /* --- PAGES --- */

        // 1. Home
        const Home = ({ setPage }) => {
            return (
                <PageTransition>
                <div className="flex flex-col justify-center items-center min-h-[80vh] text-center px-4 relative">
                    <div className="absolute inset-0 bg-[linear-gradient(rgba(10,20,30,0)_1px,transparent_1px),linear-gradient(90deg,rgba(10,20,30,0)_1px,transparent_1px)] bg-[size:40px_40px] [mask-image:radial-gradient(ellipse_60%_60%_at_50%_50%,#000_70%,transparent_100%)] opacity-20 pointer-events-none" />

                    <motion.div 
                    initial={{ y: 20, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ delay: 0.2 }}
                    className="inline-block px-4 py-1 rounded-full border border-cyan-500/30 bg-cyan-950/30 text-cyan-400 text-xs font-mono mb-8"
                    >
                    SYSTEM VERSION 2.0.4 // ONLINE
                    </motion.div>

                    <motion.h1 
                    className="text-6xl md:text-8xl font-black text-white mb-4 tracking-tighter cursor-default select-none"
                    initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} transition={{ type: "spring", duration: 1 }}
                    >
                    <motion.span 
                        className="inline-block"
                        whileHover={{ 
                        color: "#22d3ee", 
                        x: -15, 
                        rotate: -5,
                        textShadow: "2px 2px 0px rgba(34,211,238,0.8)"
                        }}
                    >
                        AI
                    </motion.span>
                    
                    <span className="inline-block w-4" /> 

                    <motion.span 
                        className="inline-block text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-violet-500"
                        whileHover={{ 
                        scale: 1.1,
                        filter: "drop-shadow(0 0 15px rgba(139,92,246,0.6)) hue-rotate(60deg)" 
                        }}
                        transition={{ type: "spring", stiffness: 300, damping: 15 }}
                    >
                        GAMEWORKS
                    </motion.span>
                    </motion.h1>
                    
                    <motion.p 
                    className="text-xl md:text-2xl text-slate-400 font-light mb-12 tracking-wide"
                    initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }}
                    >
                    Revolutionizing Game Production Protocols
                    <span className="block text-base text-slate-600 mt-2 font-mono uppercase">By Andrew Zhang</span>
                    </motion.p>

                    <div className="flex flex-col sm:flex-row gap-6">
                    <motion.button 
                        whileHover={{ scale: 1.05, boxShadow: "0 0 20px rgba(6,182,212,0.5)" }}
                        whileTap={{ scale: 0.95 }}
                        onClick={() => setPage('pipelines')}
                        className="group relative px-10 py-5 bg-cyan-600 text-white font-bold text-lg uppercase tracking-wider overflow-hidden clip-path-button"
                        style={{ clipPath: 'polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%)' }}
                    >
                        <span className="relative z-10 flex items-center gap-3">
                        <Play className="fill-current w-5 h-5" /> Start Mission
                        </span>
                        <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300" />
                    </motion.button>

                    <motion.button 
                        whileHover={{ scale: 1.05, borderColor: "rgba(168,85,247,0.8)" }}
                        whileTap={{ scale: 0.95 }}
                        onClick={() => setPage('lab')}
                        className="group px-10 py-5 bg-transparent border border-slate-600 hover:border-violet-500 text-slate-300 hover:text-white font-bold text-lg uppercase tracking-wider transition-colors"
                        style={{ clipPath: 'polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%)' }}
                    >
                        <span className="flex items-center gap-3">
                        <FlaskConical className="w-5 h-5" /> Enter Lab
                        </span>
                    </motion.button>
                    </div>
                </div>
                </PageTransition>
            );
        };

        // 2. Player Profile
        const PlayerProfile = () => {
            return (
                <PageTransition title="Player Profile" subtitle="Andrew Zhang / Level 99 Producer">
                <div className="max-w-5xl mx-auto px-4 pb-20">
                    <div className="grid md:grid-cols-3 gap-8 mb-12">
                    <div className="col-span-1 bg-slate-800/80 border border-cyan-500/50 p-8 rounded-xl text-center relative overflow-hidden group">
                        <div className="absolute inset-0 bg-gradient-to-b from-cyan-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
                        <div className="w-32 h-32 mx-auto bg-gradient-to-br from-cyan-400 to-violet-600 rounded-full flex items-center justify-center text-4xl font-bold text-white mb-6 border-4 border-slate-900 shadow-[0_0_20px_rgba(6,182,212,0.5)]">
                        AZ
                        </div>
                        <h2 className="text-2xl font-bold text-white mb-1">Andrew Zhang</h2>
                        <div className="text-cyan-400 font-mono text-xs tracking-widest uppercase mb-4">AI Pipeline Architect</div>
                        
                        <div className="flex justify-center gap-4 mt-6">
                        <a href="#" className="p-3 bg-slate-900 rounded-full hover:bg-cyan-600 hover:text-white transition-colors border border-slate-700">
                            <Mail className="w-5 h-5" />
                        </a>
                        <a href="#" className="p-3 bg-slate-900 rounded-full hover:bg-cyan-600 hover:text-white transition-colors border border-slate-700">
                            <Linkedin className="w-5 h-5" />
                        </a>
                        <a href="#" className="p-3 bg-slate-900 rounded-full hover:bg-cyan-600 hover:text-white transition-colors border border-slate-700">
                            <Twitter className="w-5 h-5" />
                        </a>
                        </div>
                    </div>

                    <div className="col-span-2 bg-slate-900/50 border border-slate-700 p-8 rounded-xl relative">
                        <div className="absolute top-4 right-4 text-slate-600"><Scroll className="w-6 h-6" /></div>
                        <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                        <Shield className="w-5 h-5 text-violet-400" /> Vision & Objectives
                        </h3>
                        <p className="text-slate-300 leading-relaxed mb-6">
                        A Game Producer and AI Practitioner passionate about exploring the frontiers of technology. 
                        I don't just care about <span className="text-cyan-400">"what AI can generate"</span>, but <span className="text-violet-400">"how AI reshapes the game industrial pipeline"</span>.
                        </p>
                        <p className="text-slate-400 text-sm leading-relaxed">
                        The game industry is undergoing an unprecedented productivity revolution. I built this lab to deconstruct every link in game production and re-examine it through the lens of AI: What can be automated? What can be enhanced? This is not just about efficiency, but about unleashing developer creativity.
                        </p>
                    </div>
                    </div>

                    <div className="mb-12">
                    <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2 font-mono uppercase tracking-wider">
                        <Sword className="w-5 h-5 text-yellow-500" /> Equipped Skills
                    </h3>
                    <div className="flex flex-wrap gap-4">
                        {[
                        { name: 'Game Production', lvl: 'MAX' },
                        { name: 'Project Management', lvl: 'LV.90' },
                        { name: 'Tech Ops', lvl: 'LV.85' },
                        { name: 'Business Dev', lvl: 'LV.80' },
                        { name: 'AI Research', lvl: 'LV.88' },
                        { name: 'Agile/Scrum', lvl: 'LV.95' }
                        ].map((skill, idx) => (
                        <div key={idx} className="bg-slate-800 border border-slate-600 px-4 py-2 rounded flex items-center gap-3 hover:border-cyan-400 transition-colors cursor-default">
                            <span className="text-white font-bold text-sm">{skill.name}</span>
                            <span className="text-xs font-mono text-cyan-400 bg-cyan-950 px-1.5 py-0.5 rounded">{skill.lvl}</span>
                        </div>
                        ))}
                    </div>
                    </div>

                    <div className="bg-slate-900/80 border border-slate-700 rounded-xl p-8">
                    <h3 className="text-lg font-bold text-white mb-8 flex items-center gap-2 font-mono uppercase tracking-wider">
                        <Map className="w-5 h-5 text-green-500" /> Quest Log (Experience)
                    </h3>
                    <div className="space-y-8 relative before:absolute before:left-2 before:top-2 before:bottom-2 before:w-0.5 before:bg-slate-700 ml-2">
                        {[
                        { year: 'Present', role: 'AI Pipeline Specialist', desc: 'Focusing on AI implementation research and consulting for the full game lifecycle.' },
                        { year: '2021-2023', role: 'Senior Game Producer', desc: 'Responsible for pipeline construction and agile management for large-scale RPG projects.' },
                        { year: '2018-2021', role: 'Tech Operations / PM', desc: 'Optimized art outsourcing workflows and engine toolchain support.' },
                        ].map((item, idx) => (
                        <div key={idx} className="relative pl-8">
                            <div className="absolute left-0 top-1.5 w-4 h-4 bg-slate-900 border-2 border-cyan-500 rounded-full z-10" />
                            <div className="flex flex-col sm:flex-row sm:items-center gap-2 mb-1">
                            <h4 className="text-lg font-bold text-white">{item.role}</h4>
                            <span className="text-xs font-mono text-cyan-500 bg-cyan-950/50 px-2 py-0.5 rounded border border-cyan-900/50 w-fit">
                                {item.year}
                            </span>
                            </div>
                            <p className="text-slate-400 text-sm">{item.desc}</p>
                        </div>
                        ))}
                    </div>
                    </div>
                </div>
                </PageTransition>
            );
        };

        // 3. Lab Page (RENAMED TO TEST SERVER)
        const LabPage = () => {
            return (
                <PageTransition title="Test Server" subtitle="Experimental Protocols (PTR) & PoC Archive">
                <div className="max-w-6xl mx-auto px-4 pb-20">
                    <div className="grid gap-8">
                    {LAB_EXPERIMENTS.map((exp, idx) => (
                        <motion.div 
                        key={exp.id}
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ delay: idx * 0.1 }}
                        className="bg-slate-800/80 border border-slate-700 rounded-xl overflow-hidden hover:border-cyan-500/50 transition-colors group"
                        >
                        <div className="flex items-center justify-between p-6 bg-slate-900/50 border-b border-slate-700">
                            <div className="flex items-center gap-4">
                            <div className="p-3 bg-slate-800 rounded border border-slate-600 text-cyan-400">
                                <Server className="w-6 h-6" />
                            </div>
                            <div>
                                <h3 className="text-lg font-bold text-white group-hover:text-cyan-400 transition-colors">{exp.title}</h3>
                                <div className="text-xs font-mono text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                <span className="text-cyan-600">ID: {exp.code}</span>
                                <span>//</span>
                                <span>{exp.category}</span>
                                </div>
                            </div>
                            </div>
                            <div className={`px-3 py-1 rounded text-xs font-mono font-bold border ${exp.statusColor}`}>
                            {exp.status}
                            </div>
                        </div>
                        
                        <div className="p-6 grid md:grid-cols-2 gap-8">
                            <div className="space-y-4">
                            <div>
                                <div className="text-xs text-slate-500 uppercase font-bold mb-1 flex items-center gap-2">
                                <TestTube className="w-3 h-3" /> Problem
                                </div>
                                <p className="text-slate-300 text-sm leading-relaxed">{exp.problem}</p>
                            </div>
                            <div>
                                <div className="text-xs text-slate-500 uppercase font-bold mb-1 flex items-center gap-2">
                                <Microscope className="w-3 h-3" /> Methodology
                                </div>
                                <p className="text-slate-300 text-sm leading-relaxed">{exp.method}</p>
                            </div>
                            </div>
                            
                            <div className="space-y-4">
                            <div className="bg-green-900/10 border-l-2 border-green-500 pl-4 py-1">
                                <div className="text-xs text-green-400 uppercase font-bold mb-1">Conclusion</div>
                                <p className="text-slate-200 text-sm leading-relaxed">{exp.conclusion}</p>
                            </div>
                            <div className="bg-violet-900/10 border-l-2 border-violet-500 pl-4 py-1">
                                <div className="text-xs text-violet-400 uppercase font-bold mb-1">Pipeline Impact</div>
                                <p className="text-slate-200 text-sm leading-relaxed">{exp.impact}</p>
                            </div>
                            </div>
                        </div>
                        </motion.div>
                    ))}
                    </div>
                </div>
                </PageTransition>
            );
        };

        // 4. Articles Page
        const ArticlesPage = () => {
            return (
                <PageTransition title="Mission Logs" subtitle="Thoughts, Essays and Deep Dives">
                <div className="max-w-5xl mx-auto px-4 pb-20">
                    <div className="grid gap-6">
                    {ARTICLES_LIST.map((article, idx) => (
                        <motion.div 
                        key={article.id}
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: idx * 0.1 }}
                        className="bg-slate-800/60 border border-slate-700 p-6 rounded-lg hover:bg-slate-800 hover:border-cyan-500/50 transition-all cursor-pointer group"
                        >
                        <div className="flex flex-col md:flex-row md:items-center justify-between mb-3">
                            <div className="flex items-center gap-3 mb-2 md:mb-0">
                            <span className="px-2 py-0.5 bg-cyan-950 border border-cyan-900 text-cyan-400 text-[10px] font-mono font-bold uppercase rounded">
                                {article.category}
                            </span>
                            <span className="text-slate-500 text-xs font-mono flex items-center gap-1">
                                <Calendar className="w-3 h-3" /> {article.date}
                            </span>
                            </div>
                            <div className="flex gap-2">
                            {article.tags.map(tag => (
                                <span key={tag} className="text-slate-600 text-xs font-mono">#{tag}</span>
                            ))}
                            </div>
                        </div>
                        
                        <h3 className="text-xl font-bold text-white mb-2 group-hover:text-cyan-400 transition-colors flex items-center">
                            <Terminal className="w-5 h-5 mr-2 opacity-50 group-hover:opacity-100" />
                            {article.title}
                        </h3>
                        
                        <p className="text-slate-400 text-sm leading-relaxed pl-7">
                            {article.summary}
                        </p>
                        
                        <div className="mt-4 pl-7 flex items-center text-xs font-bold text-cyan-600 group-hover:text-cyan-400 uppercase tracking-widest transition-colors opacity-0 group-hover:opacity-100 transform translate-x-[-10px] group-hover:translate-x-0 duration-300">
                            Read Log <ArrowRight className="w-3 h-3 ml-1" />
                        </div>
                        </motion.div>
                    ))}
                    </div>
                </div>
                </PageTransition>
            );
        };

        // 5. Galaxy Mission Select
        const GalaxyMissionSelect = ({ setPage, setPipeline }) => {
            const [currentPhaseIdx, setCurrentPhaseIdx] = useState(0);
            const [hoverPhaseIdx, setHoverPhaseIdx] = useState(null);
            const [hoveredModule, setHoveredModule] = useState(null); 
            
            const phase = PHASES_CONFIG[currentPhaseIdx];
            const displayPhase = hoverPhaseIdx !== null ? PHASES_CONFIG[hoverPhaseIdx] : phase; 

            return (
                <PageTransition title="Mission Select">
                    <div className="relative w-full h-[60vh] overflow-hidden border-y border-slate-800/50 bg-slate-900/20">
                        <div className="absolute inset-0 pointer-events-none z-20 flex flex-col justify-center">
                            <div className="w-full max-w-7xl mx-auto px-4 h-full relative">
                                <div className="absolute top-8 left-4 md:left-0 transition-all duration-300 max-w-sm">
                                    <div className="text-cyan-400 font-mono text-xs uppercase tracking-widest mb-2">
                                        {hoverPhaseIdx !== null ? "TARGET SECTOR" : "CURRENT SECTOR"}
                                    </div>
                                    <h2 className="text-5xl font-black text-white mb-2 hud-text">{displayPhase.name}</h2>
                                    <p className="text-slate-400 text-lg">{displayPhase.desc}</p>
                                    
                                    <AnimatePresence>
                                        {hoveredModule && (
                                            <motion.div 
                                                initial={{ x: -20, opacity: 0 }}
                                                animate={{ x: 0, opacity: 1 }}
                                                exit={{ x: -20, opacity: 0 }}
                                                className="mt-8 pointer-events-none"
                                            >
                                                <div className="text-xs text-yellow-400 font-mono uppercase tracking-widest mb-2 animate-pulse">
                                                    <Target className="w-3 h-3 inline mr-1" /> TARGET LOCK ACQUIRED
                                                </div>
                                                <div className="p-4 bg-slate-900/90 border border-cyan-500/50 border-l-4 border-l-cyan-400 rounded shadow-[0_0_30px_rgba(34,211,238,0.3)] backdrop-blur-md">
                                                    <div className="text-lg font-bold text-white mb-1">{hoveredModule.name}</div>
                                                    <div className="text-xs text-slate-400 font-mono uppercase flex items-center gap-2">
                                                        <span className="w-2 h-2 bg-cyan-500 rounded-full"></span>
                                                        {hoveredModule.domainTitle}
                                                    </div>
                                                </div>
                                            </motion.div>
                                        )}
                                    </AnimatePresence>
                                </div>
                            </div>
                        </div>

                        <GalaxyScene 
                            currentPhaseIdx={currentPhaseIdx} 
                            hoverPhaseIdx={hoverPhaseIdx} 
                            onSelectModule={(id) => { setPipeline(id); setPage('pipeline-detail'); }} 
                            onChangePhase={(idx) => setCurrentPhaseIdx(idx)}
                            onHoverPhase={(idx) => setHoverPhaseIdx(idx)}
                            onHoverModule={setHoveredModule} 
                        />
                    </div>

                    <div className="max-w-4xl mx-auto px-4 mt-[-30px] relative z-30 flex justify-center">
                        <div className="bg-slate-900/90 backdrop-blur border border-slate-700 rounded-full p-2 shadow-2xl flex gap-2 overflow-x-auto no-scrollbar">
                            {PHASES_CONFIG.map((p, idx) => (
                                <button 
                                    key={p.id} 
                                    onClick={() => setCurrentPhaseIdx(idx)}
                                    onMouseEnter={() => setHoverPhaseIdx(idx)}
                                    onMouseLeave={() => setHoverPhaseIdx(null)}
                                    className={`px-6 py-3 rounded-full text-xs font-bold uppercase transition-all duration-300 whitespace-nowrap ${
                                        idx === currentPhaseIdx 
                                            ? 'bg-cyan-600 text-white shadow-[0_0_20px_rgba(34,211,238,0.6)] scale-110' 
                                            : idx === hoverPhaseIdx 
                                                ? 'bg-slate-700 text-white scale-105' 
                                                : 'text-slate-500 hover:text-slate-300'
                                    }`}
                                >
                                    {p.name}
                                </button>
                            ))}
                        </div>
                    </div>
                </PageTransition>
            );
        };

        // 6. Pipeline Detail
        const PipelineDetail = ({ pipelineId, goBack }) => {
            let data = DOMAINS_DATA[pipelineId];
            if (!data) { Object.entries(DOMAINS_DATA).forEach(([domainKey, domainData]) => { if (domainData.phase_modules.find(m => m.id === pipelineId)) { data = domainData; } }); }
            if (!data) return <div className="pt-32 text-center text-white">Data Loading... <button onClick={goBack}>Back</button></div>;
            return (
                <PageTransition>
                    <div className="max-w-6xl mx-auto px-4 pb-20 pt-8">
                        <button onClick={goBack} className="mb-6 text-slate-400 hover:text-white flex items-center uppercase text-xs font-bold tracking-widest"><ChevronLeft className="w-4 h-4 mr-1"/> Return to Galaxy</button>
                        <div className="relative bg-slate-900/80 border border-slate-700 rounded-2xl p-8 mb-8 overflow-hidden">
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-1/2 h-full energy-beam pointer-events-none opacity-30" />
                            <div className="relative z-10 flex flex-col items-center text-center">
                                <div className="p-4 bg-slate-800 rounded-full border border-cyan-500/50 text-cyan-400 mb-4 shadow-[0_0_30px_rgba(6,182,212,0.3)]">
                                    {React.cloneElement(data.icon, { size: 48 })}
                                </div>
                                <h1 className="text-4xl md:text-5xl font-black text-white mb-4">{data.title}</h1>
                                <p className="text-xl text-slate-300 max-w-2xl">{data.headerDesc}</p>
                                <div className="grid grid-cols-3 gap-6 mt-8 w-full max-w-3xl">
                                    {data.value && data.value.map((val, i) => (
                                        <div key={i} className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 text-center">
                                            <div className="text-xs text-slate-500 uppercase mb-1">{val.label}</div>
                                            <div className="text-3xl font-black text-white mb-1">{val.val}</div>
                                            <div className="text-[10px] text-cyan-400">{val.desc}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="grid md:grid-cols-3 gap-8">
                            <div className="col-span-2 space-y-8">
                                <div className="bg-slate-900/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Activity className="text-cyan-400"/> Operational Flow</h3>
                                    <div className="flex flex-wrap gap-3">
                                        {data.flow.map((step, i) => (
                                            <div key={i} className="flex items-center">
                                                <span className="bg-slate-800 border border-slate-600 px-4 py-2 rounded text-sm text-slate-200">{i+1}. {step}</span>
                                                {i < data.flow.length - 1 && <div className="w-4 h-0.5 bg-slate-700 mx-1"></div>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Zap className="text-yellow-400"/> Upgrade Analysis</h3>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-12 text-xs font-mono text-slate-500 uppercase mb-2">
                                            <div className="col-span-3">Metric</div>
                                            <div className="col-span-4">Traditional</div>
                                            <div className="col-span-5">AI Enhanced</div>
                                        </div>
                                        {data.comparison.map((c, i) => (
                                            <div key={i} className="grid grid-cols-12 text-sm border-b border-slate-800 pb-3 items-center last:border-0">
                                                <div className="col-span-3 text-slate-300 font-bold">{c.dimension}</div>
                                                <div className="col-span-4 text-slate-500 line-through">{c.trad}</div>
                                                <div className="col-span-5 text-cyan-400 font-bold flex items-center gap-2">
                                                    <CheckCircle2 className="w-4 h-4" /> {c.ai}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="col-span-1 space-y-6">
                                <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase mb-4">Tech Stack</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {data.tools.map(t => <span key={t} className="px-2 py-1 bg-cyan-950 text-cyan-400 text-xs rounded border border-cyan-900">{t}</span>)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </PageTransition>
            );
        };

        // 7. Simple Page (Unchanged)
        const SimplePage = ({ title, icon: Icon, desc }) => (
            <PageTransition title={title}>
            <div className="flex flex-col items-center justify-center min-h-[50vh] text-center px-4">
                <div className="p-6 bg-slate-800 rounded-full mb-6 animate-pulse">
                <Icon className="w-12 h-12 text-cyan-400" />
                </div>
                <p className="text-xl text-slate-300 max-w-lg mb-8">{desc}</p>
                <div className="px-4 py-2 bg-yellow-500/10 border border-yellow-500/50 text-yellow-500 font-mono text-sm rounded">
                WARNING: AREA RESTRICTED // WIP
                </div>
            </div>
            </PageTransition>
        );

        /* --- MAIN APP CONTROLLER --- */

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [currentPipeline, setCurrentPipeline] = useState(null);

            useEffect(() => {
                window.scrollTo(0, 0);
            }, [currentPage]);

            const particleMode = useMemo(() => {
                if (currentPage === 'home') return 'home';
                if (currentPage === 'pipeline-detail' && currentPipeline) {
                if (['art', '3d_asset'].includes(currentPipeline)) return 'art';
                if (['animation', 'pv'].includes(currentPipeline)) return 'animation';
                if (['qa', 'localization', 'tools'].includes(currentPipeline)) return 'qa';
                if (['design', 'research'].includes(currentPipeline)) return 'design';
                }
                return 'default';
            }, [currentPage, currentPipeline]);

            return (
                <div className="min-h-screen text-slate-100 selection:bg-cyan-500/30">
                    <ThreeBackground mode={particleMode} />
                    <NavBar setPage={setCurrentPage} currentPage={currentPage} />
                    <AnimatePresence mode="wait">
                        {currentPage === 'home' && (
                        <motion.div key="home" exit={{ opacity: 0 }}>
                            <Home setPage={setCurrentPage} />
                        </motion.div>
                        )}
                        {currentPage === 'about' && (
                        <motion.div key="about" exit={{ opacity: 0 }}>
                            <PlayerProfile />
                        </motion.div>
                        )}
                        {currentPage === 'pipelines' && (
                        <motion.div key="pipelines" exit={{ opacity: 0 }}>
                            <GalaxyMissionSelect key="pipelines" setPage={setCurrentPage} setPipeline={setCurrentPipeline} />
                        </motion.div>
                        )}
                        {currentPage === 'pipeline-detail' && (
                        <motion.div key="pipeline-detail" exit={{ opacity: 0 }}>
                            <PipelineDetail pipelineId={currentPipeline} goBack={() => setCurrentPage('pipelines')} />
                        </motion.div>
                        )}
                        {currentPage === 'lab' && (
                        <motion.div key="lab" exit={{ opacity: 0 }}>
                            <LabPage />
                        </motion.div>
                        )}
                        {currentPage === 'articles' && (
                        <motion.div key="articles" exit={{ opacity: 0 }}>
                            <ArticlesPage />
                        </motion.div>
                        )}
                        {currentPage === 'toolbox' && (
                        <motion.div key="toolbox" exit={{ opacity: 0 }}>
                            <SimplePage title="Arsenal / Toolbox" icon={Wrench} desc="Approved AI Tools & Software Stack." />
                        </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>